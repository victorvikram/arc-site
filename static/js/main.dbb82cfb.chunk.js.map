{"version":3,"sources":["components/Pixel.js","components/Row.js","components/DrawingPanel.js","components/Editor.js","App.js","index.js"],"names":["Pixel","props","selectedColor","dragging","changeColor","pixelColor","useState","dispPixelColor","setDispPixelColor","applyColor","new_index","colors","indexOf","backgroundColor","className","onMouseDown","onMouseEnter","onMouseLeave","style","Row","width","pixelColors","pixels","j","push","new_val","InputGrid","problemCat","grid","setDestToSource","contextRows","testRows","swapAandB","indexTrail","stage","type","lockedVariables","handleGridTypeChange","handleGridRowChange","handleGridColChange","handleAnswerLengthChange","correctAnswer","setCorrectAnswer","multipleChoice","penColor","setPixelColor","handleSceneRowChange","handleSceneColChange","setString","univSwapRows","rowIndex","currRowIndexTrail","nextRowIndexTrail","alt","currAltIndexTrail","nextAltIndexTrail","console","log","id","options","selection","onChange","NumberInput","name","value","length","useGrid","newArray","i","Math","ceil","scene","makeInto2dArray","rows","columns","colIndex","answerChangeFunc","fullCurrIndexTrail","concat","fullCounterpartIndexTrail","lastRow","GridCell","copyToCounterpart","displaySwap","swapWithNext","content","calcValFromIndexTrail","correct","changeWidth","e","changeHeight","newVal","row","col","generateGrid","PixelEditor","TextEditor","string","target","onClick","checked","setDragging","preventDefault","onMouseUp","twoDArrayCopy","arr","cols","new_arr","Array","fill","map","startArray","restrictedArr","index","Editor","problemId","setProblemId","setProblemCat","defaultGridType","setDefaultGridType","setMultipleChoice","currentItemIndexTrail","setCurrentItemIndexTrail","createGridCellByType","problem","setProblem","setPenColor","useEffect","setLockedVariables","componentRef","useRef","handleQuestionLengthChange","event","newLength","parseInt","setArrayLength","generator","copyArr","difference","abs","pop","setProblemGrid","setGridRowCount","newRowCount","changeRowCount","probFromAlt","setGridColCount","newColCount","changeColCount","newGrid","newProblem","changeValFromIndexTrail","setGridType","newType","calcStage","createGrid","cat","key","keySplit","split","includes","len","gridIndex","gridType","calcGridType","choiceLen","choiceIndex","gridGiven","gridElement","dimCounter","constructor","calcIsAnswerGrid","calc2dArrayFromDict","dict","num_cols","row_index","floor","oldRowCount","colCount","pushArray","rowCount","oldColCount","applyBounds","number","ref","FileUpload","handleChange","fileReader","FileReader","readAsText","files","onload","JSON","parse","result","newProblemContext","contextGrid","newMultipleChoice","newProblemQuestions","stimulusGrid","answers","setStateFromRegFileUpload","input_grid","output_grid","answer","setStateFromArcFileUpload","GridMenus","setIndexTrail","isNaN","newIndexTrail","populateIndexTrail","handleCorrectAnswer","augIndexTrail","getCorrectAnswer","newCount","r","c","copyGrid","setRowCount","setColCount","sceneRow","sceneCol","gridRow","gridCol","replaceItemsWithoutMutating","indexTrailSource","indexTrailDest","aIndexTrail","bIndexTrail","aValue","items","file","ARCJson","examples","prob","q_index","question","makeARCJson","flat","stimulus","choices","json","stringify","blob","Blob","href","URL","createObjectURL","saveAs","exportComponentAsPNG","GridViewer","panelsFromIndexTrailLists","indexTrailLists","allIndexTrails","panels","activePanel","answerIndexTrail","srcIT","dstIT","a","b","evt","idx","color","sr","sc","gr","gc","str","arcLayout","leftSide","rightSide","rightIndexTrails","modifiedRightSide","bottomIndexTrails","bottomSide","bongardLayout","inputGrids","val","makeInputGrids","selectLists","maxIndex","keys","generateIndexTrailSelectLists","onChangeComplete","hex","circleSize","circleSpacing","SelectList","htmlOptions","ToggleAnswerButton","this","show","calculateText","React","Component","Canvas","canvasRef","createRef","data","height","buffer","Uint8ClampedArray","pos","canvas","current","ctx","getContext","clearRect","imgData","createImageData","set","putImageData","color_dict","cw","ch","padding","w","h","min","save","fillStyle","fillRect","redraw","drawGrayscale","drawCategorical","ProblemViewer","problem_data","state","problem_type","problem_type_choices","problem_name","problem_choices","description","handleProblemTypeChange","bind","handleProblemChange","fetch","then","res","unshift","setState","getRelevantProblems","url_tail","requestUrl","ids","hasOwnProperty","getDescription","getProblemTypes","getProblem","problem_part","Object","grids","context","answer_type","questions","QuestionViewer","comps","no_choices","addStimulus","addChoices","addAnswer","AnswerViewer","onButtonPress","TestViewer","generateQuestionDivs","table","item_index","getRelevantData","buildTable","ind","makeOptions","ContextViewer","tables","getTables","ContentSquare","thing","decode","App","mode","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.dbb82cfb.chunk.js","sourcesContent":["import React, { useState } from 'react';\r\nimport \"../styles/pixel.scss\";\r\nimport { colors } from './Editor';\r\n\r\nexport default function Pixel(props) {\r\n    const {selectedColor, dragging, changeColor, pixelColor} = props;\r\n    const [dispPixelColor, setDispPixelColor] = useState(null);\r\n\r\n    function applyColor() {\r\n        let new_index = colors.indexOf(selectedColor);\r\n        changeColor(new_index);\r\n        setDispPixelColor(null);\r\n    }\r\n\r\n    function changeColorOnMouseEnter() {\r\n        if(dragging) {\r\n            applyColor()\r\n        }\r\n        else {\r\n            setDispPixelColor(selectedColor);\r\n        }\r\n    }\r\n\r\n    function resetColor() {\r\n        setDispPixelColor(null);\r\n    }\r\n\r\n    var backgroundColor = dispPixelColor == null ? colors[pixelColor] : dispPixelColor;\r\n\r\n    return (\r\n        <div \r\n            className=\"pixel\"\r\n            onMouseDown={applyColor}\r\n            onMouseEnter={changeColorOnMouseEnter} \r\n            onMouseLeave={resetColor} \r\n            style={{backgroundColor: backgroundColor }}>\r\n        </div>\r\n    );\r\n    \r\n}","import React from 'react';\r\nimport \"../styles/row.scss\";\r\nimport Pixel from './Pixel'\r\n\r\nexport default function Row(props) {\r\n    const { width, selectedColor, dragging, changeColor, pixelColors} = props;\r\n    let pixels = [];\r\n\r\n    for(let j = 0; j < width; j++) {\r\n        pixels.push(<Pixel key={j} selectedColor={selectedColor} dragging={dragging} changeColor={(new_val) => changeColor(j, new_val)} pixelColor={pixelColors[j]} />);\r\n    }\r\n    \r\n    return (\r\n        <div className=\"row\">{pixels}</div>\r\n    );\r\n}","import React, { useState } from 'react';\r\nimport \"../styles/drawingPanel.scss\";\r\nimport { exportComponentAsPNG } from \"react-component-export-image\";\r\n\r\nimport Row from \"./Row\";\r\nimport { colors } from './Editor';\r\nimport { NumberInput, SelectList, calcValFromIndexTrail } from './Editor';\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport default function InputGrid(props) {\r\n    const {problemCat, grid, setDestToSource, contextRows, testRows, swapAandB, indexTrail, stage, type, lockedVariables, handleGridTypeChange, handleGridRowChange, handleGridColChange, handleAnswerLengthChange, correctAnswer, setCorrectAnswer, multipleChoice, penColor, setPixelColor, handleSceneRowChange, handleSceneColChange, setString} = props;\r\n    function univSwapRows(rowIndex) {\r\n\r\n        if(stage === \"context\") {\r\n            let currRowIndexTrail = [...indexTrail];\r\n            currRowIndexTrail.push(rowIndex);\r\n            let nextRowIndexTrail = [...indexTrail];\r\n            nextRowIndexTrail.push(rowIndex + 1);\r\n            swapAandB(currRowIndexTrail, nextRowIndexTrail)\r\n        }\r\n        else if(stage === \"answer\" || stage === \"stimulus\") {\r\n            let currRowIndexTrail = [...indexTrail];\r\n            let nextRowIndexTrail = [...indexTrail];\r\n            nextRowIndexTrail[1] = + (( +nextRowIndexTrail[1]) + 1);\r\n            swapAandB(currRowIndexTrail, nextRowIndexTrail);\r\n\r\n            \r\n            let alt = stage === \"stimulus\" ? \"answer\" : \"stimulus\";\r\n            let currAltIndexTrail = [indexTrail[0], indexTrail[1], alt];\r\n            let nextAltIndexTrail = [indexTrail[0], (+ (+ indexTrail[1]) + 1), alt];\r\n            swapAandB(currAltIndexTrail, nextAltIndexTrail);\r\n            \r\n        } \r\n    }\r\n    function generateGrid() {\r\n        let useGrid;\r\n        if(stage === \"answer\") {\r\n            useGrid = makeInto2dArray(grid);\r\n        } else {\r\n            useGrid = grid;\r\n        }\r\n        \r\n        let rows = [];\r\n        for(let i = 0; i < useGrid.length; i++) {\r\n\r\n            let columns = [];\r\n            for(let j = 0; j < useGrid[0].length; j++) {\r\n                let rowIndex = stage === \"answer\" ? i * 3 + j : i;\r\n                let colIndex = stage === \"answer\" ? null : j;\r\n\r\n                console.log(correctAnswer, rowIndex);\r\n                \r\n                let answerChangeFunc;\r\n                if(problemCat === \"bongard\") {\r\n                    answerChangeFunc = setCorrectAnswer\r\n                } else {\r\n                    answerChangeFunc = () => setCorrectAnswer(rowIndex);\r\n                }\r\n                \r\n                let fullCurrIndexTrail = indexTrail.concat([rowIndex, colIndex]);\r\n                let fullCounterpartIndexTrail;\r\n                let lastRow;\r\n\r\n                if(stage === \"context\") {\r\n                    fullCounterpartIndexTrail = indexTrail.concat([rowIndex, (+ !colIndex)]);\r\n                    lastRow = (rowIndex === (contextRows - 1));\r\n                }\r\n                else if (stage === \"stimulus\") {\r\n                    fullCounterpartIndexTrail = [indexTrail[0], indexTrail[1], \"answer\", 0];\r\n                    lastRow = (+ indexTrail[1]) === (testRows - 1);\r\n                }\r\n                else if (stage === \"answer\") {\r\n                    fullCounterpartIndexTrail = [indexTrail[0], indexTrail[1], \"stimulus\", 0, 0];\r\n                    lastRow = (+ indexTrail[1]) === (testRows - 1);\r\n                }\r\n\r\n\r\n\r\n                if(useGrid[i][j] != null) {\r\n                    columns.push(\r\n                        <GridCell\r\n                            key={j}\r\n                            type={type}\r\n                            copyToCounterpart={() => setDestToSource(fullCurrIndexTrail, fullCounterpartIndexTrail)}\r\n                            displaySwap={!lastRow && stage !== \"answer\" && colIndex % 2 === 0}\r\n                            swapWithNext={() => univSwapRows(rowIndex)}\r\n                            content={calcValFromIndexTrail([rowIndex, colIndex], grid)}\r\n                            stage={stage}\r\n                            multipleChoice={multipleChoice}\r\n                            correct={stage === \"answer\" && (correctAnswer === rowIndex)}\r\n                            setCorrectAnswer={answerChangeFunc}\r\n                            changeWidth={(e) => handleSceneColChange(e, rowIndex, colIndex)}\r\n                            changeHeight={(e) => handleSceneRowChange(e, rowIndex, colIndex)}\r\n                            penColor={penColor}\r\n                            setPixelColor={(newVal, row, col) => setPixelColor(newVal, row, col, rowIndex, colIndex)}\r\n                            setString={(newVal) => setString(newVal, rowIndex, colIndex)}\r\n                            problemCat={problemCat}\r\n                        />);\r\n                }\r\n            }\r\n            \r\n            rows.push(<div key={i} className=\"flex-container\">{columns}</div>);\r\n        }\r\n        return rows;\r\n    }\r\n\r\n    function makeInto2dArray() {\r\n        let newArray = [];\r\n\r\n        for(let i = 0; i < Math.ceil(grid.length / 3); i++) {\r\n            newArray.push([]);\r\n            for(let j = 0; j < 3; j++) {\r\n                let scene = grid[i * 3 + j];\r\n                newArray[i].push(scene);\r\n            }\r\n        }\r\n\r\n        return newArray;\r\n    }\r\n\r\n    console.log(stage);\r\n    console.log(lockedVariables);\r\n    return (\r\n        <div>\r\n            <div id=\"options\">\r\n                {\r\n                    !((stage + \"-gridType\") in lockedVariables) &&\r\n                    <SelectList id={stage + \"-gridType\"} options={[\"pixels\", \"string\"]} selection={type} onChange={handleGridTypeChange}/>\r\n                }\r\n                {  \r\n                    stage === \"answer\" && !(\"answer-choice\" in lockedVariables) &&\r\n                    <NumberInput id={\"answer-choice\"} name=\"# Choices\" value={grid.length} onChange={handleAnswerLengthChange} />\r\n                }\r\n                {  \r\n                     !(stage === \"answer\") && !((stage + \"-row\") in lockedVariables) && problemCat !== \"arc\" &&\r\n                    <NumberInput id={stage + \"-row\"} name=\"# Rows\" value={grid.length} onChange={handleGridRowChange} />\r\n                }\r\n                {  \r\n                     !(stage === \"answer\") && !((stage + \"-row\") in lockedVariables) && problemCat === \"arc\" &&\r\n                    <NumberInput id={stage + \"-row\"} name=\"# Demonstrations\" value={grid.length} onChange={handleGridRowChange} />\r\n                }\r\n                {\r\n                    !(stage === \"answer\") && !((stage + \"-col\") in lockedVariables) &&\r\n                    <NumberInput id={stage + \"-col\"} name=\"# Cols\" value={grid[0].length} onChange={handleGridColChange} />\r\n                }\r\n            </div>\r\n            {generateGrid()}\r\n        </div>     \r\n    );\r\n}\r\n\r\nexport function GridCell(props) {\r\n    const { type, content, copyToCounterpart, swapWithNext, displaySwap, stage, multipleChoice, correct, setCorrectAnswer, changeWidth, changeHeight, penColor, setPixelColor, setString, problemCat} = props;\r\n\r\n    return (\r\n        <div>\r\n            {type === \"pixels\" &&\r\n                <PixelEditor \r\n                    pixels={content}\r\n                    changeHeight={changeHeight}\r\n                    changeWidth={changeWidth}\r\n                    penColor={penColor}\r\n                    setPixelColor={setPixelColor}\r\n                />\r\n            }\r\n            {type === \"string\" &&\r\n                    <TextEditor \r\n                        string={content}\r\n                        setString={setString}\r\n                    />\r\n            }\r\n            {stage === \"stimulus\" && (problemCat === \"bongard\") &&\r\n                <div>\r\n                    <SelectList options={[\"left\", \"right\", \"neither\"]} selection={[\"left\", \"right\", \"neither\"][correct]} onChange={(e) => setCorrectAnswer([\"left\", \"right\", \"neither\"].indexOf(e.target.value))} />\r\n                </div>\r\n            }\r\n            {(problemCat === \"arc\") && \r\n                <div>\r\n                    <button onClick={copyToCounterpart}> Copy to counterpart</button>\r\n                </div>\r\n            }\r\n            {(problemCat === \"arc\") && displaySwap && \r\n                <div>\r\n                    <button onClick={swapWithNext}>Swap with next</button>\r\n                </div>\r\n            }\r\n            {stage === \"answer\" && multipleChoice && !(problemCat !== \"bongard\") &&\r\n                <div>\r\n                    <label>\r\n                        <input\r\n                        type=\"checkbox\"\r\n                        checked={correct}\r\n                        onChange={setCorrectAnswer}\r\n                        />\r\n                        Correct\r\n                    </label>\r\n                </div>\r\n            }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport function TextEditor(props) {\r\n    const { string, setString } = props;\r\n    return (\r\n        <div className=\"flex-child\">\r\n            <input type=\"text\" value={string} onChange={(e) => setString(e.target.value)} /> \r\n        </div>\r\n    )\r\n}\r\n\r\nexport function PixelEditor(props) {\r\n    const { pixels, changeHeight, changeWidth, penColor, setPixelColor} = props;\r\n    const [dragging, setDragging] = useState(false);\r\n    let componentRef = React.createRef()\r\n\r\n    function startDragging(e) {\r\n        e.preventDefault();\r\n        setDragging(true);\r\n    }\r\n\r\n    let rows = [];\r\n\r\n    for (let i = 0; i < pixels.length; i++) {\r\n        rows.push(<Row key={i} width={pixels[0].length} selectedColor={penColor} dragging={dragging} changeColor={(col, new_val) => setPixelColor(new_val, i, col)} pixelColors={pixels[i]} />);\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex-child\">\r\n            <div id=\"options\">\r\n                <NumberInput name=\"Width\" value={pixels[0].length} onChange={changeWidth} />\r\n                <NumberInput name=\"Height\" value={pixels.length} onChange={changeHeight} />\r\n            </div>\r\n            <div \r\n                id=\"pixels\" \r\n                onMouseEnter={() => setDragging(false)}\r\n                onMouseLeave={() => setDragging(false)}\r\n                onMouseDown={startDragging} \r\n                onMouseUp={() => setDragging(false)}>\r\n                {rows}\r\n            </div>\r\n        </div>\r\n    );\r\n}","import React, { useState, useRef, useEffect } from 'react';\r\nimport \"../styles/editor.scss\";\r\nimport InputGrid from \"./DrawingPanel\";\r\nimport {CirclePicker} from \"react-color\";\r\nimport { exportComponentAsPNG } from \"react-component-export-image\";\r\nimport { saveAs } from \"file-saver\";\r\n\r\nexport const colors = [\"#000000\", \"#0068cf\", \"#ff3937\", \"#00c443\", \"#ffd631\", \"#a0a0a0\", \"#f916b1\", \"#ff7a2c\", \"#63d6fc\", \"#820f23\"]\r\n\r\nlet circleSize = 28\r\nlet circleSpacing = 14\r\n\r\nfunction twoDArrayCopy(arr) {\r\n    const rows = arr.length;\r\n    const cols = arr[0].length;\r\n    var new_arr = Array(arr.length).fill().map(() => Array(arr[0].length));\r\n    for(var i = 0; i < rows; i++) {\r\n        for(var j = 0; j < cols; j++) {\r\n            new_arr[i][j] = arr[i][j];\r\n        }\r\n    }\r\n    return new_arr;\r\n}\r\n\r\nfunction replaceItemsWithoutMutating(arr, row, col, new_val) {\r\n    var new_arr = twoDArrayCopy(arr);\r\n    new_arr[row][col] = new_val;\r\n\r\n    return new_arr;\r\n}\r\n\r\n// list arr -> \r\n// finds whatever value is located at indexTrail in startArray\r\nexport function calcValFromIndexTrail(indexTrail, startArray) {\r\n    let restrictedArr = startArray;\r\n    let index = 0;\r\n\r\n    while(indexTrail[index] != null) {\r\n        restrictedArr = restrictedArr[indexTrail[index]];\r\n        index += 1\r\n    }\r\n\r\n    return restrictedArr;\r\n}\r\n\r\n\r\nexport function NumberInput(props) {\r\n    return (\r\n        <div className=\"option\">\r\n            <input\r\n                type=\"number\"\r\n                className=\"panelInput\"\r\n                value={props.value}\r\n                onChange={props.onChange}\r\n            />\r\n            <span className=\"inputLabel\" >{props.name}</span>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default function Editor() {\r\n\r\n    const [problemId, setProblemId] = useState(\"other-0\"); // identifier for the problem, saved in exported json\r\n    const [problemCat, setProblemCat] = useState(\"arc\"); // category for the problem, may change the layout of the editor. PUBLISH CHANGE: this ARC\r\n    const [defaultGridType, setDefaultGridType] = useState(\"pixels\"); // determines the type of newly created grids\r\n    const [multipleChoice, setMultipleChoice] = useState(false); // determines whether the question is multiple choice\r\n    \r\n    // the list of indices that lead to the currently displayed grid\r\n    // irrelevant when multiple grids are displayed at the same time\r\n    const [currentItemIndexTrail, setCurrentItemIndexTrail] = useState([\"context\", 0, null]); \r\n    \r\n    // information about the problem \r\n    const [problem, setProblem] = \r\n            useState({\"context\": [[[createGridCellByType(defaultGridType)]]], \r\n                     \"questions\": [{\"stimulus\": [[createGridCellByType(defaultGridType)]], \"answer\": [createGridCellByType(defaultGridType)], \"correct\": 0}]});\r\n\r\n\r\n    // color with which to modify pixel grids\r\n    const [penColor, setPenColor] = useState(colors[0]);\r\n    \r\n    // the locked variables for various different problem categories\r\n    const lockedVariables = {\r\n                                \"arc\": {\r\n                                        \"contextLength\": 1,\r\n                                        \"multipleChoice\": false,\r\n                                        \"defaultGridType\": \"pixels\",\r\n                                        \"context-col\": 2, \r\n                                        \"stimulus-col\": 1, \r\n                                        \"stimulus-row\": 1,\r\n                                        \"answer-choice\": 1, \r\n                                        \"context-gridType\": \"pixels\",\r\n                                        \"stimulus-gridType\": \"pixels\",\r\n                                        \"answer-gridType\": \"pixels\"\r\n                                    },\r\n                                \"bongard\": {\r\n                                        \"contextLength\": 2,\r\n                                        \"multipleChoice\": true,\r\n                                        \"defaultGridType\": \"pixels\",\r\n                                        \"context-col\": 2,\r\n                                        \"context-row\": 3,\r\n                                        \"stimulus-col\": 1,\r\n                                        \"stimulus-row\": 1, \r\n                                        \"answer-choice\": 3, \r\n                                        \"context-gridType\": \"pixels\",\r\n                                        \"stimulus-gridType\": \"pixels\",\r\n                                        \"answer-gridType\": \"string\",\r\n                                        \"answer-choices\": [\"left\", \"right\", \"neither\"]\r\n                                },\r\n                                \"letter-string\": {\r\n                                        \"contextLength\": 1,\r\n                                        \"multipleChoice\": false,\r\n                                        \"defaultGridType\": \"string\",\r\n                                        \"context-col\": 2, \r\n                                        \"stimulus-col\": 1, \r\n                                        \"stimulus-row\": 1,\r\n                                        \"answer-choice\": 1, \r\n                                        \"context-gridType\": \"string\",\r\n                                        \"stimulus-gridType\": \"string\",\r\n                                        \"answer-gridType\": \"string\"\r\n                                },\r\n                                \"other\": {}\r\n                            }\r\n    \r\n    useEffect(() => {\r\n        setLockedVariables(\"arc\")\r\n    }, []); // publish change: just arc\r\n\r\n    const componentRef = useRef()\r\n\r\n    /*\r\n    handlers: STATE-DEPENDENT\r\n    inputs (fields, buttons) call handlers, which translates events into the correct format and calls setters\r\n    if conditions for modification are met\r\n    */\r\n\r\n    function handleFileUpload(e) {\r\n        const fileReader = new FileReader();\r\n        fileReader.readAsText(e.target.files[0], \"UTF-8\");\r\n        fileReader.onload = e => {\r\n            let content = JSON.parse(e.target.result);\r\n            if(\"context\" in content) {\r\n                setStateFromRegFileUpload(content);\r\n            } else {\r\n                setStateFromArcFileUpload(content);\r\n            }\r\n        };\r\n    }\r\n    \r\n    // list evt ->\r\n    // handles events from the SelectLists that change the gridType\r\n    function handleGridTypeChange(indexTrail, event) {\r\n        let newType = event.target.value;\r\n\r\n        let stage = calcStage(indexTrail);\r\n\r\n        if(!(stage + \"-gridType\" in lockedVariables[problemCat])) {\r\n            setGridType(indexTrail, newType);\r\n        }\r\n    }\r\n\r\n    // ->\r\n    // handles events from the checkbox that controls whether the question is multiple choice\r\n    function handleMultChoiceChange() {\r\n        if(\"multipleChoice\" in lockedVariables[problemCat]) {\r\n            setMultipleChoice(lockedVariables[problemCat][\"multipleChoice\"]);\r\n        } else {\r\n            setMultipleChoice(!multipleChoice);\r\n        }\r\n    }\r\n\r\n    // evt ->\r\n    // handles event from the SelectList that changes problem category\r\n    function handleCatChange(event) {\r\n        let newCat = event.target.value;\r\n\r\n        setLockedVariables(newCat);\r\n\r\n        setProblemCat(newCat);\r\n    }\r\n\r\n    // evt ->\r\n    // handles event from the SelectList that changes the default grid type\r\n    function handleDefaultGridTypeChange(event) {\r\n        let newGridType = event.target.value;\r\n\r\n        if(!(\"defaultGridType\" in lockedVariables[problemCat])) {\r\n            setDefaultGridType(newGridType);\r\n        }\r\n    }\r\n\r\n    // list evt -> \r\n    // handles event from input that changes number of rows in a grid\r\n    function handleGridRowChange(indexTrail, event) {\r\n        let newCount = applyBounds(parseInt(event.target.value));\r\n        let stage = calcStage(indexTrail);\r\n        if(!(stage + \"-row\" in lockedVariables[problemCat])) {\r\n            let gridType = calcGridType(calcValFromIndexTrail(indexTrail, problem));\r\n            setGridRowCount(indexTrail, newCount, () => createGridCellByType(gridType));\r\n        }\r\n    }\r\n\r\n    // list evt ->\r\n    // handles event from input that changes number of cols in a grid\r\n    function handleGridColChange(indexTrail, event) {\r\n        let newCount = applyBounds(parseInt(event.target.value));\r\n        let stage = calcStage(indexTrail);\r\n        if(!(stage + \"-col\" in lockedVariables[problemCat])) {\r\n            let gridType = calcGridType(calcValFromIndexTrail(indexTrail, problem));\r\n            setGridColCount(indexTrail, newCount, () => createGridCellByType(gridType));\r\n        }\r\n        \r\n    }\r\n\r\n    // list int -> \r\n    // handles event from checkboxes that change the correct answer\r\n    function handleCorrectAnswer(indexTrail, index) {\r\n        if(calcStage(indexTrail) === \"answer\" && multipleChoice) {\r\n            return setCorrectAnswer(indexTrail, index);\r\n        }\r\n    }\r\n\r\n    // list int int evt ->\r\n    // handles event from inputs that change the row count of a pixel grid (not the full grid)\r\n    function handleSceneRowChange(indexTrail, row, col, event) {\r\n        let rowCount = parseInt(event.target.value);\r\n        setRowCount(indexTrail, rowCount, row, col);\r\n    }\r\n\r\n    // list int int evt ->\r\n    // handles event from inputs that change the col count of a pixel grid (not the full grid)\r\n    function handleSceneColChange(indexTrail, row, col, event) {\r\n        let colCount = parseInt(event.target.value);\r\n        setColCount(indexTrail, colCount, row, col);\r\n    }\r\n\r\n    // evt ->\r\n    // handles event from input that changes the number of context grids\r\n    function handleContextLengthChange(event) {\r\n        let newLength = parseInt(event.target.value);\r\n        \r\n        if(!(\"contextLength\" in lockedVariables[problemCat])) {\r\n            setArrayLength([\"context\"], newLength, () => [[createGridCellByType(defaultGridType)]]);\r\n        }\r\n    }\r\n\r\n    // evt ->\r\n    // handles event from input that changes the number of questions\r\n    function handleQuestionLengthChange(event) {\r\n        let newLength = parseInt(event.target.value);\r\n        if(!(\"questionLength\" in lockedVariables[problemCat]) && !(\"answer-choices\" in lockedVariables[problemCat])) {\r\n            setArrayLength([\"questions\"], newLength, () => ({\"stimulus\": [[createGridCellByType(defaultGridType)]], \"answer\": [createGridCellByType(defaultGridType)], \"correct\": 0}));\r\n        } else if(!(\"questionLength\" in lockedVariables[problemCat])) {\r\n            setArrayLength([\"questions\"], newLength, () => ({\"stimulus\": [[createGridCellByType(defaultGridType)]], \"answer\": lockedVariables[problemCat][\"answer-choices\"], \"correct\": 0}));\r\n        }\r\n\r\n    }\r\n\r\n    // list evt ->\r\n    // handles event from input that changes the number of answer choices\r\n    function handleAnswerLengthChange(indexTrail, event) {\r\n        let newLength = parseInt(event.target.value);\r\n\r\n        if(!(\"questionLength\" in lockedVariables[problemCat])) {\r\n            if(newLength > 1 && !multipleChoice) {\r\n                setMultipleChoice(true);\r\n            } else if(newLength < 1) {\r\n                return\r\n            }\r\n\r\n            let gridType = calcGridType(calcValFromIndexTrail(indexTrail, problem));\r\n            setArrayLength(indexTrail, newLength, () => createGridCellByType(gridType));\r\n        }\r\n    }\r\n\r\n    /*\r\n    getters; STATE-DEPENDENT.\r\n    get important vaues from the state\r\n    */\r\n\r\n    // list -> int \r\n    // gets the correct answer for the question at indexTrail\r\n    function getCorrectAnswer(indexTrail) {\r\n        if(calcStage(indexTrail) === \"stimulus\" || calcStage(indexTrail) === \"answer\") {\r\n            return problem[indexTrail[0]][indexTrail[1]][\"correct\"];\r\n        }\r\n    }\r\n\r\n    /*\r\n    setters; STATE-DEPENDENT. set state variables based on given values.\r\n    */\r\n    function setDestToSource(indexTrailSource, indexTrailDest) {\r\n        let newProblem = {...problem};\r\n        let valToCopy = calcValFromIndexTrail(indexTrailSource, newProblem);\r\n        changeValFromIndexTrail(indexTrailDest, valToCopy, newProblem);\r\n        setProblem(newProblem);\r\n    }\r\n\r\n    function swapAandB(aIndexTrail, bIndexTrail) {\r\n        console.log(\"swapping\", aIndexTrail, bIndexTrail);\r\n        console.log(problem);\r\n        let newProblem = {...problem};\r\n        let aValue = calcValFromIndexTrail(aIndexTrail, newProblem);\r\n        let bValue = calcValFromIndexTrail(bIndexTrail, newProblem);\r\n        changeValFromIndexTrail(aIndexTrail, bValue, newProblem);\r\n        changeValFromIndexTrail(bIndexTrail, aValue, newProblem);\r\n        setProblem(newProblem);\r\n    }\r\n\r\n    // list int ->\r\n    // sets the correct answer for the question at indexTrail to index\r\n    function setCorrectAnswer(indexTrail, index) {\r\n        console.log(\"setting correct answer\");\r\n        let newProblem = {...problem};\r\n        let augIndexTrail = [...indexTrail];\r\n        augIndexTrail[2] = \"correct\";\r\n        changeValFromIndexTrail(augIndexTrail, index, newProblem)\r\n\r\n        setProblem(newProblem);\r\n        return true;\r\n    }\r\n\r\n    // list string int int ->\r\n    // changes the string at the given (gridRow, gridCol)\r\n    function setString(indexTrail, newVal, gridRow, gridCol) {\r\n        let grid = calcValFromIndexTrail(indexTrail, problem);\r\n        let copyGrid = [...grid];\r\n        changeValFromIndexTrail([gridRow, gridCol], newVal, copyGrid);\r\n\r\n        setProblemGrid(indexTrail, copyGrid);\r\n    }\r\n\r\n    // list int int int int int ->\r\n    // replaces the pixel (sceneRow, sceneCol) in the scene at (gridRow, gridCol) with newVal\r\n    function setPixelColor(indexTrail, newVal, sceneRow, sceneCol, gridRow, gridCol) {\r\n        let grid = calcValFromIndexTrail(indexTrail, problem);\r\n        let newArray = replaceItemsWithoutMutating(calcValFromIndexTrail([gridRow, gridCol], grid), sceneRow, sceneCol, newVal);\r\n        let copyGrid = [...grid];\r\n        changeValFromIndexTrail([gridRow, gridCol], newArray, copyGrid);\r\n\r\n        setProblemGrid(indexTrail, copyGrid);\r\n    }\r\n\r\n    // list int int int ->\r\n    // sets the number of columns for the pixel grid at (r, c) to colCount\r\n    function setColCount(indexTrail, colCount, r, c) {\r\n        let grid = calcValFromIndexTrail(indexTrail, problem);\r\n        let copyArr = changeColCount(calcValFromIndexTrail([r, c], grid), colCount, () => 0);\r\n\r\n        let copyGrid = [...grid]; \r\n        changeValFromIndexTrail([r, c], copyArr, copyGrid);\r\n        setProblemGrid(indexTrail, copyGrid);\r\n    }\r\n\r\n    // list int int int ->\r\n    // sets the number of columns for the pixel grid at (r, c) to rowCount\r\n    function setRowCount(indexTrail, rowCount, r, c) {\r\n        let grid = calcValFromIndexTrail(indexTrail, problem);\r\n        let copyArr = changeRowCount(calcValFromIndexTrail([r, c], grid), rowCount, () => 0);\r\n\r\n        let copyGrid = [...grid];\r\n        changeValFromIndexTrail([r, c], copyArr, copyGrid);\r\n        setProblemGrid(indexTrail, copyGrid);\r\n    }\r\n\r\n    // list int [() => gridElement] ->\r\n    // changes the length of an array to newLength, if newLength is longer, the new elements are given by generator\r\n    function setArrayLength(indexTrail, newLength, generator, alt) {\r\n        let arr = calcValFromIndexTrail(indexTrail, problem)\r\n        console.log(generator())\r\n        let copyArr = [...arr];\r\n        let difference = newLength - copyArr.length;\r\n\r\n        for(var i = 0; i < Math.abs(difference); i++) {\r\n            if(difference < 0) {\r\n                copyArr.pop();\r\n            } else if(difference > 0) {\r\n                copyArr.push(generator());\r\n            }\r\n        }\r\n        \r\n        console.log(copyArr);\r\n\r\n        let newProblem = setProblemGrid(indexTrail, copyArr, alt);\r\n\r\n        return newProblem;\r\n    }\r\n    \r\n    // list int [() => gridElement] ->\r\n    // changes the number of rows in the 2d array at indexTrail, new elements are given by generator\r\n    function setGridRowCount(indexTrail, newRowCount, generator, alt) {\r\n        let prob = probFromAlt(alt);\r\n        let arr = calcValFromIndexTrail(indexTrail, prob);\r\n        let copyArr = changeRowCount(arr, newRowCount, generator);\r\n        \r\n        return setProblemGrid(indexTrail, copyArr, alt);\r\n    }\r\n\r\n    // list int [() => gridElement] ->\r\n    // changes the number of cols in the 2d array at indexTrail, new elements are given by generator\r\n    function setGridColCount(indexTrail, newColCount, generator, alt) {\r\n        let prob = probFromAlt(alt);\r\n        let arr = calcValFromIndexTrail(indexTrail, prob);\r\n        let copyArr = changeColCount(arr, newColCount, generator);\r\n        \r\n        return setProblemGrid(indexTrail, copyArr, alt);\r\n    }\r\n\r\n    // list grid ->\r\n    // replaces the grid at indexTrail with newGrid\r\n    function setProblemGrid(indexTrail, newGrid, alt) {\r\n        let newProblem = probFromAlt(alt);\r\n        changeValFromIndexTrail(indexTrail, newGrid, newProblem);\r\n        if(typeof alt === 'undefined') {\r\n            setProblem(newProblem);\r\n        }\r\n\r\n        return newProblem;\r\n    }\r\n\r\n    // int string/int ->\r\n    // sets the indexTrail to the default trail that ends with value at index\r\n    function setIndexTrail(index, value) {\r\n        if(!isNaN(value)) {\r\n            value = parseInt(value);\r\n        } \r\n        let newIndexTrail = [...currentItemIndexTrail];\r\n        newIndexTrail[index] = value;\r\n\r\n        for(let i = index + 1; i < 3; i++) {\r\n            newIndexTrail[i] = null;\r\n        }\r\n\r\n        newIndexTrail = populateIndexTrail(newIndexTrail);\r\n\r\n        setCurrentItemIndexTrail(newIndexTrail);\r\n    }\r\n\r\n    // list string ->\r\n    // sets the grid at indexTrail to have type newType, clears grid of whatever it contains\r\n    function setGridType(indexTrail, newType, alt) {\r\n        let prob = probFromAlt(alt);\r\n        let grid = calcValFromIndexTrail(indexTrail, prob);\r\n        let newGrid;\r\n        \r\n        console.log(alt);\r\n        console.log(grid);\r\n\r\n        if(calcStage(indexTrail) === \"answer\") {\r\n            newGrid = createGrid(grid.length, null, () => createGridCellByType(newType));\r\n            return setProblemGrid(indexTrail, newGrid, alt);\r\n        } else {\r\n            newGrid = createGrid(grid.length, grid[0].length, () => createGridCellByType(newType));\r\n            return setProblemGrid(indexTrail, newGrid, alt);   \r\n        }\r\n    }\r\n\r\n    function setStateFromRegFileUpload(content) {\r\n        let newProblemContext = []\r\n        for(let i in content[\"context\"]) {\r\n            let contextGrid = calc2dArrayFromDict(content[\"context\"][i]);\r\n            newProblemContext.push(contextGrid)\r\n        }\r\n        let newProblemQuestions = []\r\n        let newMultipleChoice;\r\n        for(let i in content[\"questions\"]) {\r\n            let stimulusGrid = calc2dArrayFromDict(content[\"questions\"][i][\"stimulus\"]);\r\n            let answers;\r\n            let correct;\r\n            if(content[\"questions\"][i][\"choices\"].length === 0) {\r\n                answers = [content[\"questions\"][i][\"answer\"]];\r\n                correct = 0;\r\n                newMultipleChoice = false;\r\n            } else {\r\n                answers = content[\"questions\"][i][\"choices\"];\r\n                correct = content[\"questions\"][i][\"answer\"];\r\n                newMultipleChoice = true;\r\n            }\r\n            newProblemQuestions.push({\"stimulus\": stimulusGrid, \"answer\": answers, \"correct\": correct})\r\n        }\r\n        let newProblem = {\"context\": newProblemContext, \"questions\": newProblemQuestions};\r\n        setProblem(newProblem)\r\n        setProblemId(content[\"id\"]);\r\n        setProblemCat(content[\"category\"]);\r\n        setMultipleChoice(newMultipleChoice);\r\n    }\r\n\r\n    function setStateFromArcFileUpload(content) {\r\n        let contextGrid = [];\r\n        for(let i in content[\"train\"]) {\r\n            let input_grid = content[\"train\"][i][\"input\"];\r\n            let output_grid = content[\"train\"][i][\"output\"];\r\n            contextGrid.push([input_grid, output_grid])\r\n        }\r\n        let newProblemContext = [contextGrid];\r\n        let newProblemQuestions = []\r\n        for(let i in content[\"test\"]) {\r\n            let stimulusGrid = [[content[\"test\"][i][\"input\"]]];\r\n            let answer = [content[\"test\"][i][\"output\"]];\r\n            let correct = 0;\r\n            newProblemQuestions.push({\"stimulus\": stimulusGrid, \"answer\": answer, \"correct\": correct});\r\n        }\r\n        let newProblem = {\"context\": newProblemContext, \"questions\": newProblemQuestions};\r\n    \r\n        setProblem(newProblem)\r\n        setProblemId(\"arc-0\");\r\n        setProblemCat(\"arc\");\r\n        setMultipleChoice(false);\r\n    }\r\n\r\n    function setDefaultProblem() {\r\n        let newProblem = {\"context\": [[[createGridCellByType(defaultGridType)]]], \r\n                     \"questions\": [{\"stimulus\": [[createGridCellByType(defaultGridType)]], \"answer\": [createGridCellByType(defaultGridType)], \"correct\": 0}]}\r\n        setLockedVariables(problemCat, newProblem);\r\n\r\n    }\r\n\r\n    // string ->\r\n    // sets all variables to their locked values for the given category \r\n    function setLockedVariables(cat, newProblem = 0) {\r\n        if(newProblem === 0) {\r\n            newProblem = {... problem};\r\n        }\r\n        for(let key in lockedVariables[cat]) {\r\n            let keySplit = key.split(\"-\")\r\n            if(key === \"contextLength\") {\r\n                newProblem = setArrayLength([\"context\"], lockedVariables[cat][\"contextLength\"], () => [[createGridCellByType(defaultGridType)]], newProblem);\r\n            } else if(key === \"multipleChoice\") {\r\n                setMultipleChoice(lockedVariables[cat][\"multipleChoice\"]);\r\n            } else if(key === \"defaultGridType\") {\r\n                setDefaultGridType(lockedVariables[cat][\"defaultGridType\"]);\r\n            } else if(keySplit[0] === \"context\" && [\"row\", \"col\"].includes(keySplit[1])) {\r\n                let len = newProblem[\"context\"].length;\r\n                for(let gridIndex = 0; gridIndex < len; gridIndex++) {\r\n                    let gridType = calcGridType(calcValFromIndexTrail([\"context\", gridIndex], newProblem));\r\n                    if(keySplit[1] === \"row\") {\r\n                        newProblem = setGridRowCount([\"context\", gridIndex], lockedVariables[cat][\"context-row\"], () => createGridCellByType(gridType), newProblem);\r\n                    } else if(keySplit[1] === \"col\") {\r\n                        newProblem = setGridColCount([\"context\", gridIndex], lockedVariables[cat][\"context-col\"], () => createGridCellByType(gridType), newProblem);\r\n                    }      \r\n                }\r\n            } else if([\"stimulus\", \"answer\"].includes(keySplit[0]) && [\"row\", \"col\"].includes(keySplit[0])) {\r\n                let len = newProblem[\"questions\"].length;\r\n                for(let gridIndex = 0; gridIndex < len; gridIndex++) {\r\n                    let gridType = calcGridType(calcValFromIndexTrail([\"context\", gridIndex], newProblem));\r\n                    if(keySplit[1] === \"row\") {\r\n                        newProblem = setGridRowCount([\"questions\", gridIndex, keySplit[0]], lockedVariables[cat][keySplit[0] + \"-row\"], () => createGridCellByType(gridType), newProblem);\r\n                    } else if(keySplit[1] === \"col\") {\r\n                        newProblem = setGridColCount([\"questions\", gridIndex, keySplit[0]], lockedVariables[cat][keySplit[0] + \"-col\"], () => createGridCellByType(gridType), newProblem);\r\n                    }   \r\n                }\r\n\r\n            } else if(keySplit[0] === \"context\" && keySplit[1] === \"gridType\") {\r\n                let len = newProblem[\"context\"].length;\r\n                for(let gridIndex = 0; gridIndex < len; gridIndex++) {\r\n                    console.log(newProblem[\"context\"][gridIndex]);\r\n                    newProblem = setGridType([\"context\", gridIndex], lockedVariables[cat][\"context-gridType\"], newProblem);\r\n                }\r\n            } else if([\"stimulus\", \"answer\"].includes(keySplit[0]) && keySplit[1] === \"gridType\") {\r\n                let len = newProblem[\"questions\"].length;\r\n                for(let gridIndex = 0; gridIndex < len; gridIndex++) {\r\n                    newProblem = setGridType([\"questions\", gridIndex, keySplit[0]], lockedVariables[cat][keySplit[0] + \"-gridType\"], newProblem);\r\n                }\r\n            } else if(keySplit[0] === \"answer\" && keySplit[1] === \"choice\") {\r\n                let len = newProblem[\"questions\"].length;\r\n                for(let gridIndex = 0; gridIndex < len; gridIndex++) {\r\n                    let gridType = calcGridType(calcValFromIndexTrail([\"questions\", gridIndex, \"answer\"], newProblem));\r\n                    newProblem = setArrayLength([\"questions\", gridIndex, \"answer\"], lockedVariables[cat][\"answer-choice\"], () => createGridCellByType(gridType), newProblem);\r\n                }\r\n            } else if(keySplit[0] === \"answer\" && keySplit[1] === \"choices\") {\r\n                let len = newProblem[\"questions\"].length;\r\n                let choiceLen = newProblem[\"questions\"][0][\"answer\"].length;\r\n                for(let gridIndex = 0; gridIndex < len; gridIndex++) {\r\n                    for(let choiceIndex = 0; choiceIndex < choiceLen; choiceIndex++) {\r\n                        newProblem[\"questions\"][gridIndex][\"answer\"][choiceIndex] = lockedVariables[cat][\"answer-choices\"][choiceIndex];\r\n                    }\r\n                }\r\n\r\n            }\r\n        }\r\n        setProblem(newProblem);\r\n    }\r\n\r\n    /*\r\n    calculators; STATE-INDEPENDENT. calculates something based on given values. (sort of like state-independent getters)\r\n    */\r\n\r\n    // list ->\r\n    // Calculates the stage (\"context\", \"stimulus\", or \"answer\") based on the given indexTrail\r\n    function calcStage(indexTrail) {\r\n        if(indexTrail.includes(\"context\")) {\r\n            return \"context\";\r\n        } else if(indexTrail.includes(\"stimulus\")) {\r\n            return \"stimulus\";\r\n        } else if(indexTrail.includes(\"answer\")) {\r\n            return \"answer\";\r\n        } else {\r\n            return false; \r\n        }\r\n    }\r\n\r\n    // list -> \r\n    // given a grid of scenes/strings, deduces whether it is a set of \r\n    // answer choices (answer choices have one fewer dimension)\r\n    function calcIsAnswerGrid(grid) {\r\n        let restrictedArr = grid;\r\n        let dimCounter = 0;\r\n        while(restrictedArr.constructor === Array) {\r\n            restrictedArr = restrictedArr[0]\r\n            dimCounter += 1;\r\n        }\r\n        return (dimCounter % 2 === 1);\r\n    }\r\n\r\n    // arr ->\r\n    // examines array elements to see if it is a grid of strings or scenes\r\n    function calcGridType(gridGiven) {\r\n        let gridElement;\r\n\r\n        if(calcIsAnswerGrid(gridGiven)) {\r\n            gridElement = gridGiven[0];\r\n        } else {\r\n            gridElement = gridGiven[0][0];\r\n        }\r\n\r\n        if(typeof gridElement === 'string') {\r\n            return \"string\";\r\n        } else if(gridElement.constructor === Array) {\r\n            return \"pixels\";\r\n        }\r\n    }\r\n\r\n    function calc2dArrayFromDict(dict) {\r\n        let grid = []\r\n        let num_cols = dict[\"cols\"]\r\n        for(let i in dict[\"items\"]) {\r\n            let row_index = Math.floor(i / num_cols);\r\n            \r\n            // start a new row if necessary\r\n            if(row_index >= grid.length) {\r\n                grid.push([]);\r\n            }\r\n            grid[row_index].push(dict[\"items\"][i]);\r\n        }\r\n\r\n        return grid;\r\n    }\r\n    \r\n    /*\r\n    changers & creators; STATE-INDEPENDENT. create or change objects based on given quantities, \r\n    do not read from or write to state. (sort of like state-independent setters)\r\n    */\r\n\r\n    // list int [() => any] -> arr\r\n    // add or substact rows from arr so that the count matches newRowCount, if new rows are being added,\r\n    // generate new entries using generator\r\n    function changeRowCount(arr, newRowCount, generator) {\r\n        let oldRowCount = arr.length;\r\n        let colCount = arr[0].length;\r\n        let copyArr = twoDArrayCopy(arr);\r\n        let difference = newRowCount - oldRowCount;\r\n\r\n        for(var i = 0; i < Math.abs(difference); i++) {\r\n            if(difference < 0) {\r\n                copyArr.pop();\r\n            } else if(difference > 0) {\r\n                var pushArray = Array(colCount).fill().map(generator);\r\n                copyArr.push(pushArray);\r\n            }\r\n        }\r\n\r\n        return copyArr;\r\n    }\r\n\r\n    // list int [() => any] -> arr\r\n    // add or substract cols from arr so that the count matches newColCount, if new cols are being added,\r\n    // generate new entries using generator\r\n    function changeColCount(arr, newColCount, generator) {\r\n        let rowCount = arr.length;\r\n        let oldColCount = arr[0].length;\r\n        let copyArr = twoDArrayCopy(arr);\r\n        let difference = newColCount - oldColCount;\r\n\r\n        for(var i = 0; i < rowCount; i++) {\r\n            for(var j = 0; j < Math.abs(difference); j++) {\r\n                if(difference < 0) {\r\n                    copyArr[i].pop();\r\n                } else if(difference > 0) {\r\n                    copyArr[i].push(generator());\r\n                }\r\n            }\r\n        }\r\n\r\n        return copyArr;\r\n    }\r\n\r\n    // list any arr -> arr\r\n    // overwrite the value at arr[indexTrail] with value \r\n    function changeValFromIndexTrail(indexTrail, value, arr) {\r\n        let index = 0;\r\n        let restrictedArr = arr;\r\n\r\n        while(indexTrail[index + 1] != null) {\r\n            restrictedArr = restrictedArr[indexTrail[index]];\r\n            index += 1; \r\n        }\r\n        restrictedArr[indexTrail[index]] = value;       \r\n    }\r\n    \r\n    // int int [() => any]\r\n    // create a new grid with dimensions (rowCount, colCount) where empty spots are given by generator\r\n    function createGrid(rowCount, colCount, generator) {\r\n        if(colCount == null) {\r\n            return Array(rowCount).fill().map(generator);\r\n        } else {\r\n            return Array(rowCount).fill().map(() => Array(colCount).fill().map(generator));\r\n        }\r\n        \r\n    }\r\n\r\n    // string -> any\r\n    // creates a grid square depending on type\r\n    function createGridCellByType(type) {\r\n        if(type === \"pixels\") {\r\n            return Array(6).fill().map(() => Array(6).fill(0));\r\n        } else if(type === \"string\") {\r\n            return \"\";\r\n        }\r\n    }\r\n\r\n    \r\n    /*\r\n    helper functions\r\n    */\r\n\r\n    function probFromAlt(alt) {\r\n        let prob;\r\n        if(typeof alt === \"undefined\") {\r\n            prob = {...problem};\r\n        } else {\r\n            prob = alt;\r\n        }\r\n\r\n        return prob;\r\n    }\r\n\r\n    // list -> list\r\n    // populates an indexTrail with null values with default values\r\n    function populateIndexTrail(indexTrail) {\r\n        if(indexTrail[1] == null) {\r\n            indexTrail[1] = 0;\r\n        } \r\n        if(indexTrail[2] == null) {\r\n            indexTrail[2] = indexTrail[0] === \"context\" ? null : \"stimulus\";\r\n        }\r\n\r\n        return indexTrail;\r\n    }\r\n\r\n    // int -> int\r\n    // returns number if it is in bounds, otherwise, returns the closest value to number\r\n    // within the bounds\r\n    function applyBounds(number) {\r\n        if(number < 1) {\r\n            number = 1;\r\n        } else if(number > 30) {\r\n            number = 30;\r\n        }\r\n\r\n        return number;\r\n    }\r\n\r\n    /*\r\n    synthesizers: STATE-DEPENDENT. Generates some output based on a combination of state variables\r\n    e.g. JSON file representing problem, or a set of InputGrids to edit the problem \r\n    */\r\n\r\n    function makeARCJson() {\r\n        let ARCJson = {\"train\": [], \"test\": []}\r\n        let examples = problem[\"context\"][0]\r\n\r\n        for(let row_index in examples) {\r\n            let row = examples[row_index];\r\n            let prob = {\"input\": row[0], \"output\": row[1]};\r\n            ARCJson[\"train\"].push(prob);\r\n        }\r\n\r\n        for(let q_index in problem[\"questions\"]) {\r\n            let question = problem[\"questions\"][q_index]\r\n            let prob = {\r\n                        \"input\": question[\"stimulus\"][0][0], \r\n                        \"output\": question[\"answer\"][0]\r\n            };\r\n            ARCJson[\"test\"].push(prob);\r\n        }\r\n\r\n        return ARCJson;  \r\n    }\r\n\r\n    function exportJSON() {\r\n        let file = {}\r\n        let grid;\r\n        let rows;\r\n        let cols;\r\n        let items;\r\n\r\n        if(problemCat === \"arc\") {\r\n            file = makeARCJson()\r\n        } else {\r\n            file[\"category\"] = problemCat;\r\n            file[\"id\"] = problemId;\r\n            file[\"context\"] = [];\r\n            file[\"mode\"] = multipleChoice ? \"discriminate\" : \"generate\";\r\n            file[\"answer_type\"] = \"categorical_list\";\r\n\r\n            for(let gridIndex in problem[\"context\"]) {\r\n                grid = problem[\"context\"][gridIndex];\r\n                rows = grid.length;\r\n                cols = grid[0].length;\r\n                items = grid.flat()\r\n                file[\"context\"].push({\"rows\": rows, \"cols\": cols, \"type\": \"categorical_list\", \"items\": items});\r\n            }\r\n            file[\"questions\"] = [];\r\n            let stimulus;\r\n            let choices;\r\n            let answer;\r\n            for(let gridIndex in problem[\"questions\"]) {\r\n                stimulus = problem[\"questions\"][gridIndex][\"stimulus\"];\r\n                rows = stimulus.length;\r\n                cols = stimulus[0].length;\r\n                items = stimulus.flat();\r\n                choices = multipleChoice ? problem[\"questions\"][gridIndex][\"answer\"] : [];\r\n                answer = multipleChoice ? problem[\"questions\"][gridIndex][\"correct\"] : problem[\"questions\"][gridIndex][\"answer\"][0];\r\n\r\n                file[\"questions\"].push({\"stimulus\": {\"rows\": rows, \"cols\": cols, \"items\": items, \"type\": \"categorical_list\"},\r\n                                        \"choices\": choices,\r\n                                        \"answer\": answer})\r\n            }\r\n        }\r\n\r\n        const json = JSON.stringify(file);\r\n        const blob = new Blob([json],{type:'application/json'});\r\n\r\n        const href = URL.createObjectURL(blob);\r\n\r\n        saveAs(href);\r\n\r\n        /*\r\n        const link = document.createElement('a');\r\n        link.href = href;\r\n        link.download = \"problem.json\";\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n        */\r\n    }\r\n    /*\r\n    <label>\r\n        ID:\r\n        <input type=\"text\" value={problemId} onChange={(e) => setProblemId(e.target.value)} /> \r\n    </label>\r\n    */\r\n    return (\r\n        <div id=\"editor\" ref={componentRef}>\r\n            <h1>ARC Editor</h1>\r\n            <p>{false && JSON.stringify(problem)}</p>\r\n            \r\n            {false && <h2>Problem data</h2>}\r\n            {false &&\r\n            <div id=\"options\">\r\n                <label>\r\n                    Category:\r\n                    <SelectList id=\"category\" options={Object.keys(lockedVariables)} selection={problemCat} onChange={handleCatChange}/>\r\n                    \r\n                </label>\r\n                \r\n                {\r\n                    !(\"defaultGridType\" in lockedVariables[problemCat]) &&\r\n                    <label>\r\n                        Default grid cell type:\r\n                        <SelectList id=\"gridCellType\" options={[\"pixels\", \"string\"]} selection={defaultGridType} onChange={handleDefaultGridTypeChange}/>\r\n                    </label>   \r\n                }\r\n            </div>}\r\n            <FileUpload handleChange={handleFileUpload} />\r\n            <button onClick={setDefaultProblem}>Clear</button>\r\n            <div id=\"options\" className=\"addPadding\">\r\n                {\r\n                    !(\"contextLength\" in lockedVariables[problemCat]) &&\r\n                    <NumberInput name=\"# Context\" value={problem[\"context\"].length} onChange={handleContextLengthChange} />\r\n                }\r\n                {\r\n                    (![\"arc\", \"letter-string\", \"bongard\"].includes(problemCat)) &&\r\n                    <NumberInput name=\"# Questions\" value={problem[\"questions\"].length} onChange={handleQuestionLengthChange} />\r\n                }\r\n                \r\n            </div>\r\n            <GridMenus \r\n                indexTrail={currentItemIndexTrail} \r\n                setIndexTrail={setIndexTrail} \r\n                problemCat={problemCat} \r\n                gridType={calcGridType(calcValFromIndexTrail(currentItemIndexTrail, problem))}\r\n                problem={problem}\r\n                setPenColor={setPenColor}\r\n                penColor={penColor}   \r\n            />\r\n            <div>\r\n                {\r\n                    !(\"multipleChoice\" in lockedVariables[problemCat]) &&\r\n                    <label>\r\n                        <input\r\n                        id=\"multipleChoice\"\r\n                        type=\"checkbox\"\r\n                        checked={multipleChoice}\r\n                        onChange={handleMultChoiceChange}\r\n                        />\r\n                        Multiple Choice\r\n                    </label>\r\n                }\r\n            </div>\r\n            <div>\r\n                <GridViewer\r\n                    problemCat={problemCat}\r\n                    problem={problem}\r\n                    currentItemIndexTrail={currentItemIndexTrail}\r\n                    calcStage={calcStage}\r\n                    calcGridType={calcGridType}\r\n                    lockedVariables={lockedVariables[problemCat]}\r\n                    handleGridTypeChange={handleGridTypeChange}\r\n                    handleAnswerLengthChange={handleAnswerLengthChange}\r\n                    handleQuestionLengthChange={handleQuestionLengthChange}\r\n                    handleCorrectAnswer={handleCorrectAnswer}\r\n                    getCorrectAnswer={getCorrectAnswer}\r\n                    multipleChoice={multipleChoice}\r\n                    handleGridRowChange={handleGridRowChange}\r\n                    handleGridColChange={handleGridColChange}\r\n                    handleSceneRowChange={handleSceneRowChange}\r\n                    handleSceneColChange={handleSceneColChange}\r\n                    penColor={penColor}\r\n                    setPixelColor={setPixelColor}\r\n                    setString={setString}\r\n                    setDestToSource={setDestToSource}\r\n                    swapAandB={swapAandB}\r\n                />\r\n                <button onClick={exportJSON} className=\"button\">Export JSON</button>\r\n                <button onClick={() => exportComponentAsPNG(componentRef)} className=\"button\">Export PNG</button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction FileUpload(props) {\r\n    const {handleChange} = props;\r\n    return (\r\n        <div>\r\n            <h3>Upload problem file</h3>\r\n            <input type=\"file\" onChange={handleChange} />\r\n        </div>\r\n    );\r\n\r\n}\r\n\r\nexport function GridViewer(props) {\r\n    const { problemCat, problem, currentItemIndexTrail, calcStage, calcGridType, lockedVariables, \r\n            handleGridTypeChange, handleAnswerLengthChange, handleQuestionLengthChange, handleCorrectAnswer, getCorrectAnswer, multipleChoice,\r\n            handleGridRowChange, handleGridColChange, handleSceneRowChange, handleSceneColChange, \r\n            penColor, setPixelColor, setString, setDestToSource, swapAandB } = props;\r\n    \r\n    function bongardLayout() {\r\n        let leftIndexTrails = [[\"context\", 0]];\r\n        let rightIndexTrails = [[\"context\", 1]];\r\n        let bottomIndexTrails = [];\r\n\r\n        for(let gridIndex in problem[\"questions\"]) {\r\n            bottomIndexTrails.push([\"questions\", gridIndex, \"stimulus\"]);\r\n        }\r\n\r\n        let [leftSide, rightSide, bottomSide] = panelsFromIndexTrailLists([leftIndexTrails, rightIndexTrails, bottomIndexTrails]);\r\n\r\n        return (\r\n            <div>\r\n                <div className=\"flex-container\">\r\n                <div>\r\n                    <h3>Category 1</h3>\r\n                    {leftSide}\r\n                </div>\r\n                <div>\r\n                    <h3>Category 2</h3>\r\n                    {rightSide}\r\n                </div>\r\n                </div>\r\n                <NumberInput name=\"# Tests\" value={problem[\"questions\"].length} onChange={handleQuestionLengthChange} />\r\n                <div className=\"flex-container\">\r\n                    {bottomSide}\r\n                </div>\r\n            </div> \r\n        );\r\n    }\r\n\r\n    function panelsFromIndexTrailLists(indexTrailLists) {\r\n        let allIndexTrails = [];\r\n        let panels = [];\r\n        for(let i in indexTrailLists) {\r\n            allIndexTrails = allIndexTrails.concat(indexTrailLists[i]);\r\n            panels.push([]);\r\n        }\r\n\r\n        for(let i = 0; i < allIndexTrails.length; i++) {\r\n            let indexTrail = allIndexTrails[i];\r\n\r\n            let activePanel;\r\n            for(let j = 0; j < indexTrailLists.length; j++) {\r\n                if(indexTrailLists[j].includes(indexTrail)) {\r\n                    activePanel = panels[j];\r\n                }\r\n            }\r\n\r\n            let grid = calcValFromIndexTrail(indexTrail, problem);\r\n            \r\n            let answerIndexTrail = [indexTrail[0], indexTrail[1], \"answer\"]\r\n            activePanel.push(\r\n                <InputGrid\r\n                    problemCat={problemCat}\r\n                    grid={grid}\r\n                    contextRows={problem[\"context\"][0].length}\r\n                    testRows={problem[\"questions\"].length}\r\n                    indexTrail={indexTrail}\r\n                    setDestToSource={(srcIT, dstIT) => setDestToSource(srcIT, dstIT)}\r\n                    swapAandB={(a, b) => swapAandB(a, b)}\r\n                    stage={calcStage(indexTrail)}\r\n                    type={calcGridType(grid)}\r\n                    lockedVariables={lockedVariables}\r\n                    handleGridTypeChange={(evt) => handleGridTypeChange(indexTrail, evt)}\r\n                    handleGridRowChange={(e) => handleGridRowChange(indexTrail, e)}\r\n                    handleGridColChange={(e) => handleGridColChange(indexTrail, e)}\r\n                    handleAnswerLengthChange={(e) => handleAnswerLengthChange(indexTrail, e)}\r\n                    correctAnswer={getCorrectAnswer(indexTrail)} \r\n                    setCorrectAnswer={(idx) => handleCorrectAnswer(answerIndexTrail, idx)} \r\n                    multipleChoice={multipleChoice} \r\n                    handleSceneColChange={(e, r, c) => handleSceneColChange(indexTrail, r, c, e)} \r\n                    handleSceneRowChange={(e, r, c) => handleSceneRowChange(indexTrail, r, c, e)}\r\n                    penColor={penColor}\r\n                    setPixelColor={(color, sr, sc, gr, gc) => setPixelColor(indexTrail, color, sr, sc, gr, gc)} \r\n                    setString={(str, gr, gc) => setString(indexTrail, str, gr, gc)}\r\n                />\r\n            );\r\n        }\r\n\r\n        return panels;\r\n    }\r\n\r\n    function arcLayout() {\r\n        let leftSide = [];\r\n        let rightSide = [];\r\n        let leftIndexTrails = [[\"context\", 0]]\r\n        let rightIndexTrails = [];\r\n        \r\n        for(let gridIndex in problem[\"questions\"]) {\r\n            rightIndexTrails.push([\"questions\", gridIndex, \"stimulus\"]);\r\n            rightIndexTrails.push([\"questions\", gridIndex, \"answer\"]);\r\n        }\r\n\r\n        [leftSide, rightSide] = panelsFromIndexTrailLists([leftIndexTrails, rightIndexTrails]);\r\n\r\n    \r\n        let modifiedRightSide = [];\r\n        for(let i = 0; i < rightSide.length; i = i + 2) {\r\n            modifiedRightSide.push(\r\n                <div className=\"flex-container\">\r\n                    {[rightSide[i], rightSide[i + 1]]}\r\n                </div>\r\n            )\r\n        }\r\n\r\n        return (\r\n            <div className=\"flex-container\">\r\n                <div>\r\n                    <h3>Demonstrations</h3>\r\n                    {leftSide}\r\n                </div>\r\n                <div>\r\n                    <h3>Tests</h3>\r\n                    <NumberInput name=\"# Tests\" value={problem[\"questions\"].length} onChange={handleQuestionLengthChange} />\r\n                    {modifiedRightSide}\r\n                </div>\r\n            </div>\r\n        );  \r\n\r\n    }\r\n\r\n    function makeInputGrids() {\r\n        if(problemCat === \"arc\") {\r\n            return arcLayout();\r\n        } else if(problemCat === \"bongard\") {\r\n            return bongardLayout();\r\n        }  else if(problemCat === \"letter-string\") {\r\n            return arcLayout();\r\n        } else {\r\n            let inputGrids = [];\r\n            let grid = calcValFromIndexTrail(currentItemIndexTrail, problem);\r\n            inputGrids.push(<InputGrid \r\n                problemCat={problemCat}\r\n                grid={grid}\r\n                indexTrail={currentItemIndexTrail}\r\n                stage={calcStage(currentItemIndexTrail)}\r\n                type={calcGridType(grid)}\r\n                lockedVariables={lockedVariables}\r\n                handleGridTypeChange={(val) => handleGridTypeChange(currentItemIndexTrail, val)}\r\n                handleGridRowChange={(e) => handleGridRowChange(currentItemIndexTrail, e)}\r\n                handleGridColChange={(e) => handleGridColChange(currentItemIndexTrail, e)}\r\n                handleAnswerLengthChange={(e) => handleAnswerLengthChange(currentItemIndexTrail, e)}\r\n                correctAnswer={getCorrectAnswer(currentItemIndexTrail)} \r\n                setCorrectAnswer={(idx) => handleCorrectAnswer(currentItemIndexTrail, idx)} \r\n                multipleChoice={multipleChoice} \r\n                handleSceneColChange={(e, r, c) => handleSceneColChange(currentItemIndexTrail, r, c, e)} \r\n                handleSceneRowChange={(e, r, c) => handleSceneRowChange(currentItemIndexTrail, r, c, e)}\r\n                penColor={penColor}\r\n                setPixelColor={(color, sr, sc, gr, gc) => setPixelColor(currentItemIndexTrail, color, sr, sc, gr, gc)} \r\n                setString={(str, gr, gc) => setString(currentItemIndexTrail, str, gr, gc)}\r\n            />);\r\n\r\n            return <div className=\"flex-container\">{inputGrids}</div>;\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            {makeInputGrids()}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function GridMenus(props) {\r\n    const {indexTrail, setIndexTrail, problemCat, gridType, problem, penColor, setPenColor} = props;\r\n\r\n    function generateIndexTrailSelectLists(indexTrail) {\r\n        let selectLists = [];\r\n\r\n        selectLists.push(<SelectList id=\"type\" key={0} options={[\"context\", \"questions\"]} selection={indexTrail[0]} onChange={(e) => setIndexTrail(0, e.target.value)} />);\r\n\r\n        let maxIndex = problem[indexTrail[0]].length;\r\n\r\n        let options = [...Array(maxIndex).keys()];\r\n\r\n        selectLists.push(<SelectList id=\"parentIndex\" key={1} options={options} selection={indexTrail[1]} onChange={(e) => setIndexTrail(1, e.target.value)} />);\r\n\r\n        if(indexTrail[0] === \"questions\") {\r\n            selectLists.push(<SelectList id=\"questionPart\" key={2} options={[\"stimulus\", \"answer\"]} selection={indexTrail[2]} onChange={(e) => setIndexTrail(2, e.target.value)} />)\r\n        }\r\n    \r\n        return selectLists;\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <div>\r\n\r\n            </div>\r\n            {\r\n                ![\"arc\", \"letter-string\"].includes(problemCat) && \r\n                <div className=\"flex-container\">\r\n                    {generateIndexTrailSelectLists(indexTrail)}\r\n                </div>\r\n            }\r\n            \r\n            {\r\n                (gridType === \"pixels\" || problemCat === \"arc\") &&\r\n                <div className=\"addPadding\">\r\n                    <CirclePicker \r\n                        color={penColor} \r\n                        colors={colors} \r\n                        onChangeComplete={(color) => setPenColor(color.hex)} \r\n                        width={colors.length * (circleSize + circleSpacing)} \r\n                        circleSize={circleSize} \r\n                        circleSpacing={circleSpacing}\r\n                    />\r\n                </div>\r\n            }\r\n            \r\n            \r\n        </div>\r\n    );\r\n}\r\n\r\n\r\nexport function SelectList(props) {\r\n    const { id, options, selection, onChange } = props;\r\n\r\n    let htmlOptions = [];\r\n\r\n    for(let index in options) {\r\n        htmlOptions.push(<option key={index} value={options[index]}>{options[index]}</option>)\r\n    }\r\n\r\n    return (\r\n        <select id={id} value={selection} onChange={onChange}>\r\n                    {htmlOptions}\r\n        </select>\r\n    )\r\n\r\n}","import './App.css';\r\nimport React, { useState } from 'react';\r\nimport Editor from \"./components/Editor\";\r\nimport \"./styles/App.scss\";\r\n\r\nvar fixed_problem; // = require('./fixed_data/arr_data_4.json');\r\n\r\nclass ToggleAnswerButton extends React.Component {\r\n  calculateText() {\r\n    if(this.props.show) {\r\n      return \"Hide Answer\";\r\n    } else {\r\n      return \"Show Answer\";\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <button onClick={this.props.onClick}>\r\n        {this.calculateText()}\r\n      </button>\r\n    )\r\n  }\r\n}\r\n\r\nclass Canvas extends React.Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.canvasRef = React.createRef()\r\n  }\r\n\r\n  drawGrayscale() {\r\n    var width = this.props.data[0].length;\r\n    var height = this.props.data.length;\r\n    var buffer = new Uint8ClampedArray(width * height * 4)\r\n\r\n    for(var row = 0; row < height; row++) {\r\n      for(var col = 0; col < width; col++) {\r\n        var pos = (row * width + col) * 4\r\n        buffer[pos] = this.props.data[row][col]\r\n        buffer[pos + 1] = this.props.data[row][col]\r\n        buffer[pos + 2] = this.props.data[row][col]\r\n        buffer[pos + 3] = 255\r\n      }\r\n    }\r\n\r\n    const canvas = this.canvasRef.current\r\n    const ctx = canvas.getContext('2d')\r\n\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n    \r\n    var imgData = ctx.createImageData(width, height);\r\n    imgData.data.set(buffer)\r\n\r\n    ctx.putImageData(imgData, 0, 0)\r\n  }\r\n\r\n  drawCategorical() {\r\n\r\n    var color_dict = {\r\n      0: \"rgb(0, 0, 0)\", \r\n      1: \"rgb(0, 105, 207)\",\r\n      2: \"rgb(255, 57, 55)\",\r\n      3: \"rgb(0, 197, 67)\",\r\n      4: \"rgb(255, 215, 49)\",\r\n      5: \"rgb(160, 160, 160)\",\r\n      6: \"rgb(249, 22, 179)\",\r\n      7: \"rgb(255, 122, 44)\",\r\n      8: \"rgb(99, 214, 252)\",\r\n      9: \"rgb(130, 15, 35)\",\r\n      10:\"rgb(255, 255, 255)\"\r\n    }\r\n    const canvas = this.canvasRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    var cw = canvas.width;\r\n    var ch = canvas.height;\r\n    var rows = this.props.data.length;\r\n    var cols = this.props.data[0].length;\r\n    var padding = 0.5;\r\n    var w = (cw - (padding * cols)) / cols;\r\n    var h = (ch - (padding * rows)) / rows;\r\n    w = Math.min(w, h);\r\n\r\n    if(rows !== 1) {\r\n      h = Math.min(w, h);\r\n    }\r\n    \r\n\r\n    ctx.clearRect(0, 0, cw, ch);\r\n    ctx.save();\r\n    for (var row = 0; row < rows; row++) {\r\n      for (var col = 0; col < cols; col++) {\r\n        ctx.fillStyle = color_dict[this.props.data[row][col]]\r\n        ctx.fillRect(col * (w + padding), row * (h + padding), w, h)\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.redraw()\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.redraw() \r\n  }\r\n\r\n  redraw() {\r\n    if(this.props.type === \"grayscale\") {\r\n      this.drawGrayscale()\r\n    } else if(this.props.type === \"categorical_list\") {\r\n      this.drawCategorical()\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return <canvas ref={this.canvasRef} {... this.props} />\r\n  }\r\n}\r\n\r\nclass ProblemViewer extends React.Component {\r\n  constructor(props) {\r\n    super(props)\r\n    var problem_data = fixed_problem == null ? {} : fixed_problem;\r\n    this.state = {problem_type: \"all\", problem_type_choices: [\"\"], problem_name: \"\", problem_choices: [\"\"], problem_data: problem_data, description: \"\"} \r\n    this.handleProblemTypeChange = this.handleProblemTypeChange.bind(this)\r\n    this.handleProblemChange = this.handleProblemChange.bind(this)\r\n  }\r\n\r\n  getProblemTypes() {\r\n    let requestUrl = `/api/categories`\r\n    fetch(requestUrl)\r\n      .then((res) => res.json())\r\n      .then((data) => {\r\n        data.unshift(\"all\");\r\n        this.setState({problem_type: \"all\", problem_type_choices: data}, (state) => {\r\n          this.getRelevantProblems();\r\n        });\r\n      })\r\n  }\r\n\r\n  getRelevantProblems() {\r\n    let url_tail = this.state.problem_type === \"all\" ? \"all\" : this.state.problem_type;\r\n    let requestUrl = `/api/${url_tail}`\r\n    fetch(requestUrl)\r\n      .then((res) => res.json())\r\n      .then((data) => {\r\n        var ids = []\r\n        for(var i = 0; i < data.length; i++) {\r\n          if(data[i].hasOwnProperty('id')) {\r\n            ids.push(data[i].id);\r\n          }\r\n        }\r\n        ids.unshift(\"\");\r\n        this.setState({problem: \"\", problem_choices: ids});\r\n      });\r\n  }\r\n\r\n  getDescription() {\r\n    console.log(\"getting description\");\r\n    let requestUrl = `/api/${this.state.problem_type}/${this.state.problem_name}/description`;\r\n    fetch(requestUrl)\r\n        .then((res) => {\r\n          console.log(res);\r\n          return res.json();\r\n        })\r\n        .then((data) => {\r\n          console.log(JSON.stringify(data));\r\n          this.setState({description: data.description});\r\n        });\r\n  }\r\n\r\n  getProblem() {\r\n    if(this.state.problem_name !== \"\") {\r\n      let requestUrl = `/api/${this.state.problem_type}/${this.state.problem_name}`\r\n      fetch(requestUrl)\r\n        .then((res) => res.json())\r\n        .then((data) => {\r\n          if(fixed_problem == null) {\r\n            // console.log(\"fixed_problem is null\");\r\n            this.setState({problem_data: data}, (state) => {\r\n              this.getDescription();\r\n            })\r\n          }\r\n        });\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.getProblemTypes();\r\n  }\r\n\r\n  handleProblemTypeChange(event) {\r\n    if(event.target.value !== this.state.problem_type) {\r\n      this.setState({problem_type: event.target.value}, (state) => {\r\n        this.getRelevantProblems()\r\n      });\r\n    } \r\n  }\r\n\r\n  handleProblemChange(event) {\r\n    this.setState({problem_name: event.target.value}, (state) => {\r\n      this.getProblem();\r\n    });\r\n  }\r\n\r\n  render() {\r\n    var problem_part;\r\n    var data = this.state.problem_data\r\n    console.log(this.state.description)\r\n    if(data && Object.keys(data).length === 0) {\r\n      problem_part = []\r\n    } else {\r\n      // console.log(\"supposedly setting problem type\")\r\n      problem_part = (\r\n        <div>\r\n        <div>{this.state.description}</div>\r\n        <div className='side_by_side'>\r\n          <ContextViewer grids={this.state.problem_data.context} />\r\n          <TestViewer answer_type={this.state.problem_data.answer_type} questions={this.state.problem_data.questions} />\r\n        </div>\r\n        </div>\r\n      )\r\n    }\r\n    return (\r\n      <div>\r\n        <div className='side_by_side'>\r\n          <SelectList value={this.state.problem_type} options={this.state.problem_type_choices} onChange={this.handleProblemTypeChange} />\r\n          <SelectList value={this.state.problem_name} options={this.state.problem_choices} onChange={this.handleProblemChange} />\r\n        </div>\r\n        {problem_part}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nclass QuestionViewer extends React.Component {\r\n  addStimulus(comps) {\r\n    var rows = this.props.data.stimulus.rows;\r\n    var cols = this.props.data.stimulus.cols;\r\n    if(rows > 0 && cols > 0) {\r\n      comps.push(<GridViewer key={0} rows={rows} cols={cols} items={this.props.data.stimulus.items} type={this.props.data.stimulus.type}/>);\r\n    }\r\n  }\r\n\r\n  addChoices(comps) {\r\n    var no_choices = this.props.data.choices.length;\r\n    if(no_choices > 0) {\r\n      var rows = Math.ceil(no_choices / 3);\r\n      var cols = 3\r\n      comps.push(<GridViewer key={1}  rows={rows} cols={cols} items={this.props.data.choices} type={this.props.answer_type} />)\r\n    }\r\n  }\r\n  addAnswer(comps) {\r\n    var answer_type;\r\n    if(this.props.data.choices.length > 0) {\r\n      answer_type = \"number\";\r\n    } else {\r\n      answer_type = this.props.answer_type;\r\n    }\r\n    comps.push(<AnswerViewer key={2} answer={this.props.data.answer} type={answer_type} />);\r\n  }\r\n\r\n  render() {\r\n    var comps = []\r\n    this.addStimulus(comps)\r\n    this.addChoices(comps)\r\n    this.addAnswer(comps)\r\n    return <div>{comps}</div>\r\n  }\r\n}\r\n\r\nclass AnswerViewer extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {show: false, answer: this.props.answer}\r\n    this.onButtonPress = this.onButtonPress.bind(this)\r\n  }\r\n\r\n  onButtonPress() {\r\n    this.setState({show: !this.state.show, answer: this.props.answer})\r\n  }\r\n\r\n  render() {\r\n    var comps = [<ToggleAnswerButton key={0} onClick={this.onButtonPress} show={this.props.show} />]\r\n    \r\n    // show the answer if the state \r\n    if(this.state.show && (this.props.answer === this.state.answer)) {\r\n      comps.push(<ContentSquare key={1} type={this.props.type} data={this.props.answer} />)\r\n    }\r\n    else if (this.state.show) {\r\n      this.setState({show: false, answer: this.props.answer})\r\n    }\r\n    else if (this.props.answer !== this.state.answer) {\r\n      this.setState({answer: this.props.answer})\r\n    }\r\n\r\n    return (\r\n      <div>{comps}</div>\r\n    )\r\n  }\r\n}\r\n\r\nclass TestViewer extends React.Component {\r\n  generateQuestionDivs() {\r\n    var questions = []\r\n    for(var i = 0; i < this.props.questions.length; i++) {\r\n      questions.push(<QuestionViewer key={i} data={this.props.questions[i]} answer_type={this.props.answer_type} />)\r\n    }\r\n\r\n    return questions\r\n  }\r\n\r\n  render() {\r\n    var questions = this.generateQuestionDivs()\r\n    return (\r\n      <div>{questions}</div>\r\n    )\r\n  }\r\n}\r\n\r\nclass GridViewer extends React.Component {\r\n  getRelevantData(arr, index) {\r\n    if (index < arr.length) {\r\n      return arr[index]\r\n    }\r\n    else {\r\n      return null\r\n    }\r\n  }\r\n\r\n  buildTable() {\r\n    var table = [];\r\n    var row = [];\r\n\r\n    for (var i = 0; i < this.props.rows; i++) {\r\n      row = [];\r\n      for (var j = 0; j < this.props.cols; j++) {\r\n        var item_index = i * this.props.cols + j;\r\n        var data = this.getRelevantData(this.props.items, item_index);\r\n        //console.log(\"item_index\", item_index, this.props.items.length, this.props.rows, this.props.cols);\r\n        row.push(<td key={item_index}><ContentSquare type={this.props.type} data={data}/></td>);\r\n      }\r\n      table.push(<tr key={i}>{row}</tr>);\r\n    }\r\n\r\n    return <table><tbody>{table}</tbody></table>\r\n  }\r\n  render() {\r\n    return <div>{this.buildTable()}</div>;\r\n  }\r\n}\r\n\r\nclass SelectList extends React.Component {\r\n  makeOptions() {\r\n    var options = []\r\n    for(let ind in this.props.options) {\r\n      options.push(<option key={ind} value={this.props.options[ind]}>{this.props.options[ind]}</option>)\r\n    }\r\n    return options\r\n  }\r\n  render() {\r\n    var options = this.makeOptions();\r\n    return (\r\n      <select value={this.props.value} onChange={this.props.onChange}>\r\n        {options}\r\n      </select>\r\n    )\r\n  }\r\n}\r\n\r\nclass ContextViewer extends React.Component {\r\n  getTables() {\r\n    var tables = [];\r\n    for(var i = 0; i < this.props.grids.length; i++) {\r\n      tables.push(<GridViewer key={i} rows={this.props.grids[i].rows} cols={this.props.grids[i].cols} items={this.props.grids[i].items} type={this.props.grids[i].type} />)\r\n    }\r\n    return tables\r\n  }\r\n\r\n  render() {\r\n    var tables = this.getTables()\r\n    return (\r\n      <div className='side_by_side'>{tables}</div>\r\n    )\r\n  }\r\n}\r\n\r\nclass ContentSquare extends React.Component {\r\n  decode() {\r\n    if(this.props.data === null) {\r\n      return \"\"\r\n    } else if(this.props.type === \"string\") {\r\n      return this.props.data\r\n    } else if(this.props.type === \"grayscale\" || this.props.type === \"categorical_list\") {\r\n      //console.log(\"supposedly rendering some canvases\")\r\n      return <Canvas type={this.props.type} data={this.props.data} />\r\n    } else if(this.props.type === \"number\") {\r\n      return this.props.data\r\n    }\r\n  }\r\n\r\n  render() {\r\n    var thing = this.decode()\r\n    return <div>{thing}</div>\r\n  }\r\n}\r\n\r\n\r\nfunction App() {\r\n  const [mode, setMode] = useState(\"create\");\r\n\r\n\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      {false && \r\n        <div>\r\n          <button onClick={() => setMode(\"create\")} className=\"button\">Creator</button>\r\n          <button onClick={() => setMode(\"view\")} className=\"button\">Viewer</button>\r\n        </div> // PUBLISH change. Hide this\r\n      }\r\n      {mode === \"view\" &&\r\n        <ProblemViewer />\r\n      }\r\n      {mode === \"create\" &&\r\n        <Editor />\r\n      }\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './styles/index.scss';\r\nimport App from './App';\r\n\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);"],"sourceRoot":""}